(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(8),o=n.n(i),c=(n(14),n(1)),r=n(2),u=n(4),l=n(3),h=n(6),p=n(5),g=(n(15),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={pitch:100,rate:70,voice:"",language:"",emotion:"neutral",response:"",background:""},n}return Object(p.a)(t,e),Object(r.a)(t,[{key:"componentDidUpdate",value:function(){""===this.state.voice&&""===this.state.language&&this.setState({voice:this.props.voices[0].name,language:this.props.voices[0].lang})}},{key:"render",value:function(){var e=this.createVoices(),t=this.state.background;return s.a.createElement("div",{style:{backgroundColor:t},className:"agentcontainer"},s.a.createElement("div",{className:"propertygroup"},s.a.createElement("h4",null,"Voice Identity"),s.a.createElement("select",{onChange:this.onVoiceChanged.bind(this)},e)),s.a.createElement("div",{className:"propertygroup"},s.a.createElement("h4",null,"Language"),s.a.createElement("p",null,this.state.language)),s.a.createElement("div",{className:"propertygroup"},s.a.createElement("h4",null,"Pitch"),s.a.createElement("input",{onChange:this.onPitchChanged.bind(this),type:"range",min:"0",max:"1000",defaultValue:this.state.pitch}),s.a.createElement("div",null,this.state.pitch/100)),s.a.createElement("div",{className:"propertygroup"},s.a.createElement("h4",null,"Rate"),s.a.createElement("input",{onChange:this.onRateChanged.bind(this),type:"range",min:"0",max:"300",defaultValue:this.state.rate}),s.a.createElement("div",null,this.state.rate/100)),s.a.createElement("div",{className:"propertygroup"},s.a.createElement("h4",null,"Emotion"),s.a.createElement("select",{onChange:this.onEmotionChanged.bind(this)},s.a.createElement("option",null,"neutral"),s.a.createElement("option",null,"anger"),s.a.createElement("option",null,"sadness"),s.a.createElement("option",null,"fear"),s.a.createElement("option",null,"joy"))),s.a.createElement("div",{className:"propertygroup"},s.a.createElement("h4",null,"Response"),s.a.createElement("div",null,this.state.response," ")))}},{key:"createVoices",value:function(){var e=[];return this.props.voices.length&&(e=this.props.voices.map((function(e){return s.a.createElement("option",{key:e.name,defaultValue:e.name},e.name)}))),e}},{key:"setResponse",value:function(e){this.setState({response:e})}},{key:"clearResponse",value:function(){this.setState({response:""})}},{key:"onVoiceChanged",value:function(e){var t="";for(var n in this.props.voices){var a=this.props.voices[n];if(a.name===e.target.value){t=a.lang;break}}this.setState({voice:e.target.value,language:t})}},{key:"onEmotionChanged",value:function(e){this.setState({emotion:e.target.value})}},{key:"onPitchChanged",value:function(e){this.setState({pitch:e.target.value})}},{key:"onRateChanged",value:function(e){this.setState({rate:e.target.value})}},{key:"activateBackground",value:function(){this.setState({background:"lightblue"})}},{key:"deactivateBackground",value:function(){this.setState({background:""})}}]),t}(s.a.Component)),v=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={text:""},n}return Object(p.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"inputcontainer"},s.a.createElement("input",{onChange:this.onTextChanged.bind(this),className:"userinput",type:"text"}),s.a.createElement("button",{onClick:this.onSend.bind(this)},"SEND"),s.a.createElement("button",{onClick:this.onStop.bind(this)},"STOP"))}},{key:"onTextChanged",value:function(e){this.setState({text:e.target.value})}},{key:"onSend",value:function(e){this.props.onSend(this.state.text)}},{key:"onStop",value:function(e){this.props.onStop()}}]),t}(s.a.Component),d=function(){function e(){Object(c.a)(this,e),this.endpoint="babble-cakechat.xyz",this.uri="https://"+this.endpoint+"/cakechat_api/v1/actions/get_response"}return Object(r.a)(e,[{key:"getResponse",value:function(e,t,n){var a=new XMLHttpRequest;a.onreadystatechange=this.onReadyStateChange.bind(this,a,n,t),a.ontimeout=this.onTimeout.bind(this,n,t),a.timeout=2e4,a.open("POST",this.uri,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json");var s={context:[e],emotion:t};a.send(JSON.stringify(s))}},{key:"onReadyStateChange",value:function(e,t,n){4===e.readyState&&(200===e.status?t(JSON.parse(e.response).response):0===e.status||(console.error("Cakechat request failed with error "+e.status),console.log(e),t("ERROR",n)))}},{key:"onTimeout",value:function(e,t){console.error("Cakechat request timed out after 10 seconds. It may be down."),e("ERROR",t)}}]),e}(),m=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).synth=window.speechSynthesis,n.synth.onvoiceschanged=n.populateVoices.bind(Object(h.a)(n)),n.cakechat=new d,n.state={voices:[]},n.shouldStop=!1,n.numAgents=8,n.activeAgent=0,n.agentRefs=[],n.createAgentRefs(),n}return Object(p.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.createAgents();return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"agents"},e),s.a.createElement(v,{onSend:this.onSendInput.bind(this),onStop:this.onStopTalking.bind(this)}))}},{key:"createAgents",value:function(){for(var e=[],t=0;t<this.numAgents;t++){var n=s.a.createElement(g,{ref:this.agentRefs[t],voices:this.state.voices,key:t});e.push(n)}return e}},{key:"createAgentRefs",value:function(){for(var e=0;e<this.numAgents;e++){var t=s.a.createRef();this.agentRefs.push(t)}}},{key:"populateVoices",value:function(){var e=this.synth.getVoices().map((function(e){return{name:e.name,lang:e.lang}}));this.setState({voices:e})}},{key:"onStopTalking",value:function(){this.synth.cancel(),this.shouldStop=!0}},{key:"onSendInput",value:function(e){var t=this.agentRefs[this.activeAgent].current,n=t.state;this.shouldStop=!1,t.activateBackground(),t.clearResponse(),console.log("Cakechat: Query, Emotion - "+e+", "+n.emotion),this.cakechat.getResponse(e,n.emotion,this.cakechatCallback.bind(this))}},{key:"cakechatCallback",value:function(e,t){var n=this.agentRefs[this.activeAgent].current,a=n.state,s=this.synth.getVoices().filter((function(e){return e.name===a.voice}));n.setResponse(e);var i=new SpeechSynthesisUtterance(e);i.voice=s[0],i.pitch=a.pitch/100,i.rate=a.rate/100,i.onend=this.onSpeechEnded.bind(this),this.synth.speak(i)}},{key:"onSpeechEnded",value:function(e){this.agentRefs[this.activeAgent].current.deactivateBackground(),this.shouldStop||(this.activeAgent=(this.activeAgent+1)%this.numAgents,this.onSendInput(e.utterance.text))}}]),t}(s.a.Component);o.a.render(s.a.createElement(m,null),document.getElementById("root"))},9:function(e,t,n){e.exports=n(16)}},[[9,1,2]]]);
//# sourceMappingURL=main.65d14d62.chunk.js.map